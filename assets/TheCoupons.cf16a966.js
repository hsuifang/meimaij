import{J as u,s as m,o as c,a as l,b as t,F as h,e as _,i as g,t as d,h as f,j as p,a5 as C,a6 as I,a7 as b,a8 as y,w as v,$ as k}from"./index.365780fe.js";const w={class:"container pt-4 pb-4 pt-lg-7 pb-lg-7"},x={class:"card"},L={class:"card-body"},$={class:"d-flex justify-content-md-between pr-3 mb-4"},P=t("h2",{class:"h6 text-info"},"\u512A\u60E0\u5238\u6E05\u55AE",-1),N={class:"table caption-top"},V=t("thead",null,[t("tr",null,[t("th",{scope:"col"},"\u7522\u54C1\u540D\u7A31"),t("th",{scope:"col"},"\u6298\u6263\u78BC"),t("th",{scope:"col"},"\u4F7F\u7528\u671F\u9650"),t("th",{scope:"col"},"\u512A\u60E0\u50F9"),t("th",{scope:"col"},"\u662F\u5426\u555F\u7528"),t("th",{scope:"col"},"\u529F\u80FD")])],-1),B={key:0},D=t("td",{class:"text-center text-muted",colspan:"6"},[t("img",{alt:"loading",width:"100",src:"https://media.giphy.com/media/wnYB3vx9t6PXiq1ubB/giphy.gif"})],-1),j=[D],S={class:"form-check form-switch"},q=["onUpdate:modelValue","onChange"],M=["onClick"],T=["onClick"],U={key:0,class:"text-center text-muted",colspan:"6"},E=t("td",{class:"text-center text-muted",colspan:"6"},"\u7121\u5546\u54C1",-1),F=[E],z={class:"d-flex justify-content-md-between"},G=p(" \u76EE\u524D\u6709 "),H=p(" \u9805\u512A\u60E0\u5238 "),J={data(){return{currentItem:{},coupons:[],couponsCount:0,pageInfo:{current:1,total:1},isCreateItem:!0,isLoading:!1,questionModalContent:"",targetItemId:""}},methods:{generateItem(){return{title:"",is_enabled:1,percent:0,due_date:""}},async fetchCoupons(e=1){try{this.isLoading=!0;const s=await C(e),{coupons:n,pagination:a,success:i}=s.data;i&&(this.coupons=n,this.pageInfo={current:a.current_page,total:a.total_pages})}catch{}finally{this.isLoading=!1}},async toggleCouponItemStatus(e){try{this.isLoading=!0,this.currentItem=e,this.currentItem.is_enabled=this.currentItem.is_enabled?1:0,this.isCreateItem=!1,await this.submitCouponItem(this.currentItem)}catch{}finally{this.isLoading=!1}},async deleteCouponItem(e){try{this.isLoading=!0,(await I(e)).data.success&&this.fetchCoupons()}catch{this.isLoading=!1}},async submitCouponItem(e){try{const s=e.id,n=this.isCreateItem?await b({data:e}):await y({id:s,data:{data:e}}),{success:a}=n.data;if(a)if(s){const i=this.coupons.findIndex(o=>o.id===s);i!==-1&&(this.coupons[i]=e)}else this.fetchCoupons();this.$vHttpsNotice(n,`${this.isCreateItem?"\u65B0\u589E":"\u8ABF\u6574"}\u512A\u60E0\u5238\u8ABF\u6574`)}catch{this.$vErrorNotice()}},handleCouponItem(e){e?(this.currentItem=e,this.isCreateItem=!1):(this.currentItem=this.generateItem(),this.isCreateItem=!0)},updateCouponItem(e){this.submitCouponItem(e)},changePage(e){this.fetchCoupons(e)},checkInfo({id:e,title:s}){this.questionModalContent=`\u4F60\u78BA\u5B9A\u8981\u522A\u9664-${s}\u55CE\uFF1F`,this.targetItemId=e},init(){this.currentItem=this.generateItem(),this.fetchCoupons()}},created(){this.init()}},W=Object.assign(J,{__name:"TheCoupons",setup(e){u({data:{}});const s=u({data:[]});return(n,a)=>{const i=m("Pagination");return c(),l("div",w,[t("div",x,[t("div",L,[t("div",$,[P,t("button",{class:"btn btn-outline-primary py-2 shadow-sm",type:"button","aria-controls":"modifyCoupoonItem",onClick:a[0]||(a[0]=o=>n.handleCouponItem(null))}," \u5EFA\u7ACB\u65B0\u512A\u60E0\u5238 ")]),t("table",N,[V,t("tbody",null,[n.isLoading?(c(),l("tr",B,j)):(c(),l(h,{key:1},[(c(!0),l(h,null,_(s,o=>(c(),l("tr",{key:o.id},[t("td",null,d(o.title),1),t("td",null,d(o.code),1),t("td",null,d(o.due_date&&new Date(o.due_date).toLocaleDateString("zh-TW")),1),t("td",null,d(o.percent)+"\u6298",1),t("td",null,[t("div",S,[v(t("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":r=>o.is_enabled=r,onChange:r=>n.toggleCouponItemStatus(o)},null,40,q),[[k,o.is_enabled]])])]),t("td",null,[t("button",{type:"button",class:"btn btn-sm btn-outline-info me-1","data-action":"remove",onClick:r=>n.handleCouponItem(o)}," \u7DE8\u8F2F ",8,M),t("button",{type:"button",class:"btn btn-sm btn-danger text-white","data-action":"remove",onClick:r=>n.checkInfo({id:o.id,title:o.title})}," \u522A\u9664 ",8,T)])]))),128)),s.length===0?(c(),l("tr",U,F)):g("",!0)],64))])]),t("div",z,[t("p",null,[G,t("span",null,d(s.length),1),H]),f(i,{pageInfo:n.pageInfo,onChangePage:n.changePage},null,8,["pageInfo","onChangePage"])])])])])}}});export{W as default};
